<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Spaghetti contours: 20CR2c &#8212; Improving reanalysis with the Daily Weather Reports</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="Improving reanalysis with the Daily Weather Reports" href="../../index.html" />
    <link rel="up" title="Visualising uncertainty: spaghetti contours" href="spaghetti_contour.html" />
    <link rel="next" title="Spaghetti contours: CERA20C" href="spaghetti_contour_CERA20C.html" />
    <link rel="prev" title="Visualising uncertainty: spaghetti contours" href="spaghetti_contour.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p><a class="reference external" href="spaghetti_contour.html">Spaghetti contours main page</a></p>
<div class="section" id="spaghetti-contours-20cr2c">
<h1>Spaghetti contours: 20CR2c<a class="headerlink" href="#spaghetti-contours-20cr2c" title="Permalink to this headline">Â¶</a></h1>
<center>
<table><tr><td>
<a href="https://github.com/oldweather/DWR/raw/master/analyses/spaghetti_contour/Spaghetti_prmsl_1903102218.png"><img src="https://github.com/oldweather/DWR/raw/master/analyses/spaghetti_contour/Spaghetti_prmsl_1903102218.png""></a></td></tr>
<tr><td> MSLP Contours for 20CR2c for October 22nd, 1903 (at 6pm). Blue lines are contours from each of ensemble member, black lines the contours of the ensemble mean (only shown where the ensemble spread is less than 3hPa). Yellow dots are observations asssimilated.</td></tr>
</table>
</center><p>Collect the data (prmsl ensemble and observations from 20CR2c for 1903):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">Meteorographica.data.twcr</span> <span class="kn">as</span> <span class="nn">twcr</span>
<span class="n">twcr</span><span class="o">.</span><span class="n">fetch_data_for_year</span><span class="p">(</span><span class="s1">&#39;prmsl&#39;</span><span class="p">,</span><span class="mi">1903</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="s1">&#39;3.5.1&#39;</span><span class="p">)</span>
<span class="n">twcr</span><span class="o">.</span><span class="n">fetch_data_for_year</span><span class="p">(</span><span class="s1">&#39;observations&#39;</span><span class="p">,</span><span class="mi">1903</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="s1">&#39;3.5.1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Script to make the figure:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># UK region 20Cr2c spaghetti-contour prmsl map</span>
<span class="c1"># Use Meteorographica weathermap functions</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">import</span> <span class="nn">iris</span>
<span class="kn">import</span> <span class="nn">iris.analysis</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_agg</span> <span class="k">import</span> \
                <span class="n">FigureCanvasAgg</span> <span class="k">as</span> <span class="n">FigureCanvas</span>
<span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="k">import</span> <span class="n">Figure</span>

<span class="kn">import</span> <span class="nn">cartopy</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>

<span class="kn">import</span> <span class="nn">Meteorographica.weathermap</span> <span class="k">as</span> <span class="nn">wm</span>
<span class="kn">import</span> <span class="nn">Meteorographica.data.twcr</span> <span class="k">as</span> <span class="nn">twcr</span>

<span class="kn">import</span> <span class="nn">DWR</span>

<span class="c1"># Date to show - low humidity at Fort William</span>
<span class="n">year</span><span class="o">=</span><span class="mi">1903</span>
<span class="n">month</span><span class="o">=</span><span class="mi">10</span>
<span class="n">day</span><span class="o">=</span><span class="mi">22</span>
<span class="n">hour</span><span class="o">=</span><span class="mi">18</span>
<span class="n">dte</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">hour</span><span class="p">)</span>

<span class="c1"># Landscape page</span>
<span class="n">fig</span><span class="o">=</span><span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span><span class="mi">22</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>  <span class="c1"># Width, Height (inches)</span>
           <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
           <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.88</span><span class="p">,</span><span class="mf">0.88</span><span class="p">,</span><span class="mf">0.88</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
           <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
           <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
           <span class="n">subplotpars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">tight_layout</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">canvas</span><span class="o">=</span><span class="n">FigureCanvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

<span class="c1"># UK-centred projection</span>
<span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">RotatedPole</span><span class="p">(</span><span class="n">pole_longitude</span><span class="o">=</span><span class="mf">177.5</span><span class="p">,</span> <span class="n">pole_latitude</span><span class="o">=</span><span class="mf">35.5</span><span class="p">)</span>
<span class="n">scale</span><span class="o">=</span><span class="mi">20</span>
<span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">scale</span><span class="o">*-</span><span class="mi">1</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">scale</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">scale</span><span class="o">*-</span><span class="mi">1</span><span class="p">,</span><span class="n">scale</span><span class="p">]</span>

<span class="c1"># Single plot filling the figure</span>
<span class="n">ax_20C</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
<span class="n">ax_20C</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="n">ax_20C</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">extent</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>

<span class="c1"># Background, grid, and land</span>
<span class="n">ax_20C</span><span class="o">.</span><span class="n">background_patch</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mf">0.88</span><span class="p">,</span><span class="mf">0.88</span><span class="p">,</span><span class="mf">0.88</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">wm</span><span class="o">.</span><span class="n">add_grid</span><span class="p">(</span><span class="n">ax_20C</span><span class="p">)</span>
<span class="n">land_img_20C</span><span class="o">=</span><span class="n">ax_20C</span><span class="o">.</span><span class="n">background_img</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;GreyT&#39;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;low&#39;</span><span class="p">)</span>

<span class="c1"># Add the observations from 20CR</span>
<span class="n">obs</span><span class="o">=</span><span class="n">twcr</span><span class="o">.</span><span class="n">get_obs</span><span class="p">(</span><span class="n">dte</span><span class="o">-</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">),</span><span class="n">dte</span><span class="p">,</span><span class="s1">&#39;3.5.1&#39;</span><span class="p">)</span>
<span class="c1"># Filter to those assimilated and near the UK</span>
<span class="n">obs_s</span><span class="o">=</span><span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Assimilation.indicator&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
              <span class="p">((</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> 
                  <span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">90</span><span class="p">))</span> <span class="o">&amp;</span>
              <span class="p">((</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">240</span><span class="p">)</span> <span class="o">|</span> 
                  <span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">))]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">wm</span><span class="o">.</span><span class="n">plot_obs</span><span class="p">(</span><span class="n">ax_20C</span><span class="p">,</span><span class="n">obs_s</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>

<span class="c1"># load the pressures</span>
<span class="n">prmsl</span><span class="o">=</span><span class="n">twcr</span><span class="o">.</span><span class="n">get_slice_at_hour</span><span class="p">(</span><span class="s1">&#39;prmsl&#39;</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">hour</span><span class="p">,</span>
                             <span class="n">version</span><span class="o">=</span><span class="s1">&#39;3.5.1&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ensemble&#39;</span><span class="p">)</span>

<span class="c1"># For each ensemble member, make a contour plot</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">prmsl</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;member&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">points</span><span class="p">:</span>
    <span class="n">prmsl_e</span><span class="o">=</span><span class="n">prmsl</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">iris</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">member</span><span class="o">=</span><span class="n">m</span><span class="p">))</span>
    <span class="n">prmsl_e</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">prmsl_e</span><span class="o">.</span><span class="n">data</span><span class="o">/</span><span class="mi">100</span> <span class="c1"># To hPa</span>
    <span class="n">CS</span><span class="o">=</span><span class="n">wm</span><span class="o">.</span><span class="n">plot_contour</span><span class="p">(</span><span class="n">ax_20C</span><span class="p">,</span><span class="n">prmsl_e</span><span class="p">,</span>
                   <span class="n">levels</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">870</span><span class="p">,</span><span class="mi">1050</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
                   <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="c1"># Add the ensemble mean - with labels</span>
<span class="n">prmsl_m</span><span class="o">=</span><span class="n">prmsl</span><span class="o">.</span><span class="n">collapsed</span><span class="p">(</span><span class="s1">&#39;member&#39;</span><span class="p">,</span> <span class="n">iris</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">MEAN</span><span class="p">)</span>
<span class="n">prmsl_m</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">prmsl_m</span><span class="o">.</span><span class="n">data</span><span class="o">/</span><span class="mi">100</span> <span class="c1"># To hPa</span>
<span class="n">prmsl_s</span><span class="o">=</span><span class="n">prmsl</span><span class="o">.</span><span class="n">collapsed</span><span class="p">(</span><span class="s1">&#39;member&#39;</span><span class="p">,</span> <span class="n">iris</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">STD_DEV</span><span class="p">)</span>
<span class="n">prmsl_s</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">prmsl_s</span><span class="o">.</span><span class="n">data</span><span class="o">/</span><span class="mi">100</span>
<span class="c1"># Mask out mean where uncertainties large</span>
<span class="n">prmsl_m</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">prmsl_s</span><span class="o">.</span><span class="n">data</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">)]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
<span class="n">CS</span><span class="o">=</span><span class="n">wm</span><span class="o">.</span><span class="n">plot_contour</span><span class="p">(</span><span class="n">ax_20C</span><span class="p">,</span><span class="n">prmsl_m</span><span class="p">,</span>
                   <span class="n">levels</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">870</span><span class="p">,</span><span class="mi">1050</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
                   <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">wm</span><span class="o">.</span><span class="n">plot_label</span><span class="p">(</span><span class="n">ax_20C</span><span class="p">,</span>
              <span class="s1">&#39;</span><span class="si">%04d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">:</span><span class="si">%02d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">hour</span><span class="p">),</span>
              <span class="n">facecolor</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">())</span>
<span class="c1"># Output as png</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Spaghetti_prmsl_</span><span class="si">%04d%02d%02d%02d</span><span class="s1">.png&#39;</span> <span class="o">%</span> 
                               <span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">hour</span><span class="p">))</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Daily Weather Reports</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=oldweather&repo=DWR&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../DWR.html">The Daily Weather Reports</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../analyses.html">Appendix: Analyses of the DWR data</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../analyses.html">Appendix: Analyses of the DWR data</a><ul>
  <li><a href="spaghetti_contour.html">Visualising uncertainty: spaghetti contours</a><ul>
      <li>Previous: <a href="spaghetti_contour.html" title="previous chapter">Visualising uncertainty: spaghetti contours</a></li>
      <li>Next: <a href="spaghetti_contour_CERA20C.html" title="next chapter">Spaghetti contours: CERA20C</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
      |
      <a href="../../_sources/analyses/spaghetti_contour/spaghetti_contour_20CR2c.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>